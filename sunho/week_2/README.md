# 2주차

## 10. 국소성을 살리는 분산
> = 액세스 패턴을 고려한 분산
> - 캐싱할 수 없는 부분이 사라진다 -> 메모리는 디스크보다 10^6배나 빠르므로 그만큼 덕을 본다.

### 파티셔닝
> = DB 서버를 여러 서버로 분산시키는 방법
> - 애플리케이션 로직을 통해 요청에 따라 접근하는 DB를 나눈다.

> `테이블 데이터 분할`: 테이블 하나를 여러 테이블로 분할 한다.

### 요청 패턴을 `섬`으로 분할
> 역할 별로 시스템을 나누는 방법
> ex) 캐싱하기 쉬운 요청, 캐싱하기 어려운 요청을 처리하는 섬을 나누게 되면 높은 캐시 적중률 및 시스템을 안정시킬 수 있다.

### 페이지 캐시를 고려한 운용의 기본 규칙
> 1. OS기동 후에 서버를 곧바로 투입시키지 않는다.
>     - 캐시가 없기에 바로 디스크 액세스가 발생한다.
> 2. 성능평가 및 부하시험은 최초의 캐시가 최적화된 후 실시한다.

- - -

## 11. 인덱스 올바르게 운용하기

### OS캐시 활용
> - 전체 데이터 크기에 주의하자
>   - 데이터량 < 물리메모리를 유지한다
>   - 스키마 설계가 데이터 크기에 미치는 영향 고려
### 정규화
> - 하나의 테이블에서 필수항목과 선택항목을 기준으로 정규화를 하면 테이블의 용량을 많이 줄일 수있다.
>   - 하지만 쿼리의 성능을 고려하여 작업하는 것이 좋다.

### B-Tree
> - MySQL의 인덱스는 기본적으로 B+Tree 구조이다.
>   - 각 노드 내에 자식 노드로의 포인터만 갖고 있으며 실제 값은 제일 마지막 리프 노드에만 가지고 있는 구조이다.
> - B Tree에서 파생되었으며 탐색 시에 트리 높이만큼의 횟수만 부모-자식순으로 탐색하면 된다.
> - 높이가 데이터 건수 N에 대해 반드시 log n이므로 계산량은 O(log n)이다.

### 이분트리
> - 이분트리는 반드시 자식이 2개 이하다.
> - B 트리는 개수를 조정할 수 있기에 노드의 각 크기를 적당한 사이즈로 정할 수 있다.
>   - 트리에서 검색 시에는 노드 to 노드로 트리를 순회한다.
>   - B Tree는 각 노드의 크기를 정할 수 있기에 디스크 Seek 발생횟수를 최소화할 수 있다.
>   - OS는 한번에 노드를 읽어 캐싱하므로 같은 노드 내의 데이터는 디스크 Seek 없이 탐색이 가능하다.
> - 반면 이분트리는 여러 블록에 분산 되어 있는 데이터를 일겅야 하므로 디스크 Seek 횟수가 많아지게 된다.
***B Tree는 이론적으로 탐색량이 O(log n)이므로 선형 탐색 O(n)보다 빠르다. 이것이 인덱스로 탐색하면 빨라지는 원리다.***

- - -

## 12.MySQL의 분산

### 레플리케이션 기능
> - 흔히 우리가 접하는 마스터/슬레이브 구조로 서버를 확장하는 기능이다.
> - 보통은 조회 등의 참조 쿼리만 로드밸런싱을 하고 삽입 / 갱신 등의 작업은 마스터로 직접 던진다.
> - 슬레이브 앞단에 로드밸런서를 사용하지 않고 애플리케이션 측에서 분배하거나 MySQL proxy를 이용할 수도 있다.

### 데이터 삽입 / 갱신의 확장
> - 시청기록 등의 쓰기작업이 굉장히 많이 필요한 데이터의 경우에는 NoSQL도 하나의 방법이 될 수 있다.
> - 단순 key-value 로 저장하여 값을 저장하고 꺼낼 뿐이므로 오버헤드가 적고 압도적으로 빠르며 확장하기 쉽.

- - -

## 13. MySQL의 스케일아웃 & 파티셔닝

### 파티셔닝
> - 분산된 서버의 테이블들을 JOIN해야만 하는 경우가 있는데 이는 불가능하다.
> - 기본적으로 JOIN 쿼리 대상이 되는 테이블들은 서버 분할하지 않을 것이라 보장할 수 있을 때만 사용한다.
> - 상반관계 (trade-off)
>   - 운용이 복잡해진다.
>   - 서버가 늘어나는 만큼 고장확률이 높아질 수 있다.
>   - 무중단을 위해서는 마스터 1대 + 슬레이브 3대가 적절하다.
>     - 한대가 고장날 경우, 다른 하나에서 복사를 해야하기 때문에 계속 서비스를 제공하는 슬레이브가 존재해야 한다.

- - -

## 14. 용도특화형 인덱싱

### 인덱스와 시스템 구성
> - RDBMS의 한계가 있는 작업 (전문 검색, 유사문서 탐색 등)에서는 배치 처리로 RDBMS에서 데이터를 추출해 별도의 인덱스 서버를 운영하는 방법을 사용할 수 있다.
### 용도특화형 인덱싱
> - 
